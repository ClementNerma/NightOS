<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The registry - NightOS documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Design and specification documents for NightOS">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">NightOS documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/ClementNerma/NightOS" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="registry"><a class="header" href="#registry">Registry</a></h1>
<p>This document describes the format of the <a href="../technical/registry.html">system registy</a> as well as its content.</p>
<ul>
<li><a href="#format">Format</a>
<ul>
<li><a href="#notes-about-types">Notes about types</a></li>
</ul>
</li>
<li><a href="#hffr-format">HFFR Format</a></li>
<li><a href="#structure">Structure</a></li>
</ul>
<h2 id="format"><a class="header" href="#format">Format</a></h2>
<p>The registry is located in the <code>/etc/sys/registry</code> file. It's basically a nested B-Tree map.</p>
<p>Each map has string keys and a value that describes the entry: its purpose, its type with optional constraints, and then the type-safe value.</p>
<p>All types are described as a name, optionally followed by a maximum number of entries between brackets or a maximum number of bytes between braces. Here is the list, in <a href="#hffr-format">HFRR notation</a>:</p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Size (s) in bytes</th><th>Description</th></tr></thead><tbody>
<tr><td><code>struct</code></td><td>s = ?</td><td>A structure - keys are ASCII strings and values' type may be various</td></tr>
<tr><td><code>string</code></td><td>s = ?</td><td>An UTF-8 encoded string</td></tr>
<tr><td><code>string[x]</code></td><td>x &lt;= s &lt;= x * 4</td><td>An UTF-8 encoded string with a maximum capacity of <code>x</code> characters</td></tr>
<tr><td><code>string{x}</code></td><td>s &lt;= x * 4</td><td>An UTF-8 encoded string with a maximum capacity of <code>x</code> bytes</td></tr>
<tr><td><code>asciistr</code></td><td>s = ?</td><td>An ASCII encoded string</td></tr>
<tr><td><code>asciistr[x]</code></td><td>s &lt;= x</td><td>An ASCII encoded string with a maximum capacity of <code>x</code> characters</td></tr>
<tr><td><code>asciistr{x}</code></td><td>s &lt;= x</td><td>An ASCII encoded string with a maximum capacity of <code>x</code> bytes</td></tr>
<tr><td><code>int{x}</code></td><td>s = x</td><td>A signed integer on <code>x</code> bytes</td></tr>
<tr><td><code>uint{x}</code></td><td>s = x</td><td>An unsigned integer on <code>x</code> bytes</td></tr>
<tr><td><code>float{x}</code></td><td>s = x</td><td>A floating-point number on <code>x</code> bytes</td></tr>
<tr><td><code>pfloat{x}</code></td><td>s = x</td><td>A positive floating-point number on <code>x</code> bytes</td></tr>
<tr><td><code>ints</code></td><td>s = {CPU bits}</td><td>A signed integer on as many bytes as the CPU</td></tr>
<tr><td><code>uints</code></td><td>s = {CPU bits}</td><td>An unsigned integer on as many bytes as the CPU</td></tr>
<tr><td><code>bool</code></td><td>s = 1</td><td>A boolean</td></tr>
<tr><td><code>list:type</code></td><td>s = ?</td><td>A list of entries with the provided <code>type</code></td></tr>
<tr><td><code>list[x]:type</code></td><td>s = sizeof(type) * x</td><td>A list of entries with the provided <code>type</code> with a maximum of <code>x</code> entries</td></tr>
<tr><td><code>structlist</code></td><td>s = ?</td><td>A list of structures guaranteeing its first entry (the structure model) will never be removed</td></tr>
<tr><td><code>map:(key):(val)</code></td><td>s = ?</td><td>A dictionary mapping keys of the <code>key</code> to values of the <code>val</code> type</td></tr>
<tr><td><code>mapc:(key):(val)</code></td><td>s = ?</td><td>A dictionary mapping all possible keys of the <code>key</code> to values of the <code>val</code> type</td></tr>
<tr><td><code>structmap:(key)</code></td><td>s = ?</td><td>A dictionary mapping keys of the <code>key</code> to structures</td></tr>
<tr><td><code>structmapc:(key)</code></td><td>s = ?</td><td>A dictionary mapping all possible keys of the <code>key</code> to structures</td></tr>
<tr><td><code>time(p)</code></td><td>s &lt;= 8</td><td>A duration with a precision of <code>p</code> (see below)</td></tr>
<tr><td><code>tmin(p,min)</code></td><td>s &lt;= 8</td><td>Equivalent of <code>time(p)</code> but with a minimum value</td></tr>
<tr><td><code>tmax(p,min)</code></td><td>s &lt;= 8</td><td>Equivalent of <code>time(p)</code> but with a maximum value</td></tr>
<tr><td><code>tbtw(p,min,max)</code></td><td>s &lt;= 8</td><td>Equivalent of <code>time(p)</code> but with a minimum and a maximum value</td></tr>
<tr><td><code>stime(p)</code></td><td>s &lt;= 8</td><td>Equivalent of <code>time(p)</code> but allows negative durations</td></tr>
<tr><td><code>size(p)</code></td><td>s &lt;= 8</td><td>A data size with a precision of <code>p</code> (see below)</td></tr>
<tr><td><code>smin(p,min)</code></td><td>s &lt;= 8</td><td>Equivalent of <code>size(p)</code> but with a minimum value</td></tr>
<tr><td><code>smax(p,min)</code></td><td>s &lt;= 8</td><td>Equivalent of <code>size(p)</code> but with a maximum value</td></tr>
<tr><td><code>sbtw(p,min,max)</code></td><td>s &lt;= 8</td><td>Equivalent of <code>size(p)</code> but with a minimum and a maximum value</td></tr>
<tr><td><code>id:app</code></td><td>s &lt;= 256</td><td>Identifier of an installed application (ASCII string)</td></tr>
<tr><td><code>id:lib</code></td><td>s &lt;= 256</td><td>Identifier of an installed library (ASCII string)</td></tr>
<tr><td><code>id:user</code></td><td>s = 4</td><td>Identifier of an installed user (32-bit unsigned number)</td></tr>
<tr><td><code>in:(type):(a...)</code></td><td>s = max(sizeof(type))</td><td>Any value in the provided tuple</td></tr>
<tr><td><code>enum:(a,b,c,...)</code></td><td>s = 1</td><td>One of <code>a</code>, <code>b</code>, <code>c</code>...</td></tr>
</tbody></table>
</div>
<p>The registry's root is a <code>struct</code>. Each key-value association in a struct is called a <em>node</em>. Nodes that are single values (neither a list, a map or a structure) are called <em>leafs</em>.</p>
<p>All sizes that are exceptly provided in bytes must be a multiple of two.</p>
<h3 id="notes-about-types"><a class="header" href="#notes-about-types">Notes about types</a></h3>
<ul>
<li>
<p>Durations (<code>time</code>, <code>tmin</code>, <code>tmax</code> and <code>tbtw</code> types) have a precision which indicate the smallest unit of time they accept. <code>1</code> is for years, <code>2</code> for months, <code>3</code> for weeks, <code>4</code> for days, <code>5</code> for hours, <code>6</code> for minutes, <code>7</code> for seconds, <code>8</code> for milliseconds, <code>9</code> for microseconds and <code>10</code> for nanoseconds.</p>
</li>
<li>
<p>Sizes (<code>size</code>, <code>smin</code>, <code>smax</code> and <code>sbtw</code> types) accept values that are a multiple of their precision. <code>1</code> is for terabytes, <code>2</code> for gigabytes, <code>3</code> for megabytes, <code>4</code> for kilobytes, <code>5</code> for bytes and <code>6</code> for bits.</p>
</li>
<li>
<p>For the <code>struct</code> type, there is no need to specify the list of possible keys and the type of associated values, because they are already present in the registry when it's installed by the system - so it's all implicit. The keys in a struct should never change through time, nor the type of the value of each key. As such, it is not possible to create a list of <code>struct</code>, for instance.</p>
</li>
<li>
<p>For map structures (<code>structmap</code> and <code>structmapc</code>), the first key when sorting using the default algorithm for each type is guaranteed to never be removed. Its mapped value acts as the model structure for all over values in the map.</p>
</li>
</ul>
<h2 id="hffr-format"><a class="header" href="#hffr-format">HFFR Format</a></h2>
<p>The registry can be converted for debugging to an HFRR text file (Human-Friendly Registry Format).</p>
<p>In this format, structures' keys are described using the <code>key(type):</code> format. Each line following it describing its value is indented by a tabulation (<code>\t</code>). The tabulation is decreased when the value has been fully describes.</p>
<p>Strings are describes using double quotes, with a <code>r</code> prefix symbol for ASCII strings. Floating-point numbers use a <code>.</code> symbol as their decimal separators, and an explicit <code>+</code> or <code>-</code> symbol indicates all numbers' sign.</p>
<p>Each list entry is prefixed by a <code>-</code> symbol, and each key is described as a set of <code>key: value</code> list (on multiple lines for lists and maps).</p>
<p>Empty lists are represented as <code>[]</code> and empty maps as <code>{}</code>.</p>
<p>Durations are represented as a combination of one or more integer numbers each followed by a time suffix (<code>ns</code> for nanoseconds, <code>us</code> for microseconds, <code>ms</code> for milliseconds, <code>s</code> for seconds, <code>m</code> for minutes, <code>h</code> for hours, <code>d</code> for days, <code>w</code> for weeks, <code>mo</code> for months or <code>y</code> for years). Also, combinations use the space separator and numbers are represented with leading zeros if necessary, except for the first number.</p>
<p>So for instance, a duration of 2 days and 10 seconds will give the string <code>2d 10s</code>.</p>
<p>Sizes are represented just like times, but with different suffixes (<code>TB</code> for terabytes, <code>GB</code> for gigabytes, <code>MB</code> for megabytes, <code>KB</code> for kilobytes, <code>B</code> for bytes and <code>b</code> for bits), and without leading zeroes.</p>
<p>So for instance a size of two terabytes and three kilobyte will be represented as <code>1TB 3KB</code>.</p>
<p>The easiest way to understand the format is to look at the default registry structure presented below.</p>
<h2 id="structure"><a class="header" href="#structure">Structure</a></h2>
<p><strong>NOTE: This section is under heavy development and is by no mean complete!</strong></p>
<p>Here is the content of the default registry file (when installing NightOS with all default settings), converted to the <a href="#hffr-format">HFRR format</a>:</p>
<pre><code class="language-yaml"># Kernel configuration (only editable in developer mode)
kernel(struct):
  # Signals configuration
  signals(struct):
    # Delay before forced suspension after WILL_SUSPEND signal
    suspend_delay(time(ms)): 500ms
    # Delay before forced termination (kill) after WILL_TERMINATE signal
    terminate_delay(time(ms)): 500ms
    # Delay for a service to answer a connection request
    service_answer_delay(ntime(ms,100ms)): 500ms

# System configuration
system(struct):
  # Debugging options
  debugging(struct):
    # Is development mode enabled?
    dev_mode(bool): true

  # Encryption
  encryption(struct):
    # Is the global storage encrypted?
    global_encrypted(bool): false

  # Date and time
  datetime(struct):
    # Is it based on the internet? (if not, it's a custom one)
    internet_based(bool): true
    # In the case the date is not internet-based, provide a timestamp which indicates the difference between the computer's
    #  local datetime and the one that should be displayed
    custom_based_diff(stime(ns)): 0ns

  # Crash saves
  crash_saves(struct):
    # Restore crash saves as soon as the user logs in
    restore_on_login(bool): true
    # Do not save crash saves for guest users
    disable_for_guest_user(bool): true
    # Delay between each crash save
    collect_every(tmin(s,1s)): 60s
    # Ask an application to create a new crash save even if the previous new has not been completed yet
    collect_if_previous_unanswered(bool): false

  # Freeze-prevention
  freeze_prevention(struct):
    # Reserved amount of memory (0 = disabled)
    reserved_memory(MB): 16MB
    # Reserved amount of CPU per virtual core (0 = disabled)
    reserved_cpu_vcore(uint{1}): 1

  # Processes' lifecycle
  processes(struct):
    # Delay before suspension
    suspend_delay(time(ms)): 500ms
    # Delay before termination
    terminate_delay(time(ms)): 2000ms
    # Delay for services to answer connections
    service_answer_delay(time(ms)): 2000ms

# Users (keys = user's unique identifier, value = user's type with 0 = main admin., 1 = admin., 2 = standard, 3 = guest)
# Detailed informations about each user (nickname, privileges, encryption password, ...) and groups are stored
#   in the user profiles file at '/etc/sys/users'
users(map:(uint{4}):(enum:(MainAdmin, Admin, Standard, Guest))):
  0: Admin # System
  1: Admin # Administrator
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../specs/containers.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../specs/vocabulary.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../specs/containers.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../specs/vocabulary.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>

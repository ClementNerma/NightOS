<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Filesystem interfaces - NightOS documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Design and specification documents for NightOS">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">NightOS documentation</h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/ClementNerma/NightOS" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="filesystem-interfaces"><a class="header" href="#filesystem-interfaces">Filesystem interfaces</a></h1>
<p>Filesystem interfaces are services that act as a layer of indirection between a storage <a href="../system/hw.html#drivers">driver</a> and the <a href="../system/fs.html"><code>sys::fs</code></a> service. Their role is to translate all common filesystem operations, such as items management and modification, for filesystems that aren't <a href="../system/fs.html#list-of-natively-supported-filesystems">natively supported</a>. They heavily communicate with the <a href="../system/hw.html"><code>sys::hw</code></a> service to communicate with the underlying storage device.</p>
<p>A filesystem is tied to only one partition, and each partition has a filesystem. A storage space is made, unless empty, of a partitions table which lists all the available partitions.</p>
<p>Most <a href="#methods">methods</a> and <a href="#notifications">notifications</a> of filesystems interfaces are also available in the <a href="../system/fs.html"><code>sys::fs</code></a> service, with first perform permissions checking and determines the device and location to perform the operation on. It also leverages many more powerful features such as items watching, and features that are our of the scope of a filesystem interface such as partitions management.</p>
<p>As an application can only expose one single filesystem interface service, the said service will handle all of the hardware devices driven by the said process. This is why the the <a href="#storage-operating-range">SOR</a> of the target partition and filesystem is provided for each request.</p>
<ul>
<li><a href="#nomenclature">Nomenclature</a>
<ul>
<li><a href="#storage-operating-range">Storage operating range</a></li>
<li><a href="#filesystem-paths">Filesystem paths</a></li>
<li><a href="#split-paths">Split paths</a></li>
<li><a href="#filenames">Filenames</a></li>
<li><a href="#capabilities-list">Capabilities list</a></li>
<li><a href="#filesystem-metadata">Filesystem metadata</a></li>
<li><a href="#item-type-byte">Item type byte</a></li>
<li><a href="#item-flags">Item flags</a></li>
<li><a href="#item-metadata">Item metadata</a></li>
</ul>
</li>
<li><a href="#methods">Methods</a>
<ul>
<li><a href="#0x0001-handled_fs_list"><code>0x0001</code> HANDLED_FS_LIST</a></li>
<li><a href="#0x0002-is_valid_partition"><code>0x0002</code> IS_VALID_PARTITION</a></li>
<li><a href="#0x0003-fs_metadata"><code>0x0003</code> FS_METADATA</a></li>
<li><a href="#0x1000-item_exists"><code>0x1000</code> ITEM_EXISTS</a></li>
<li><a href="#0x1001-feid_to_split"><code>0x1001</code> FEID_TO_SPLIT</a></li>
<li><a href="#0x1002-item_metadata"><code>0x1002</code> ITEM_METADATA</a></li>
<li><a href="#0x1003-rename_item"><code>0x1003</code> RENAME_ITEM</a></li>
<li><a href="#0x1004-move_item"><code>0x1004</code> MOVE_ITEM</a></li>
<li><a href="#0x1005-delete_item"><code>0x1005</code> DELETE_ITEM</a></li>
<li><a href="#0x2000-create_directory"><code>0x2000</code> CREATE_DIRECTORY</a></li>
<li><a href="#0x2001-read_directory"><code>0x2001</code> READ_DIRECTORY</a></li>
<li><a href="#0x3000-create_file"><code>0x3000</code> CREATE_FILE</a></li>
<li><a href="#0x3001-read_file_sync"><code>0x3001</code> READ_FILE_SYNC</a></li>
<li><a href="#0x3002-read_file_async"><code>0x3002</code> READ_FILE_ASYNC</a></li>
<li><a href="#0x3003-write_file_sync"><code>0x3003</code> WRITE_FILE_SYNC</a></li>
<li><a href="#0x3004-write_file_async"><code>0x3004</code> WRITE_FILE_ASYNC</a></li>
<li><a href="#0x4000-create_symlink"><code>0x4000</code> CREATE_SYMLINK</a></li>
<li><a href="#0x4001-update_symlink"><code>0x4001</code> UPDATE_SYMLINK</a></li>
<li><a href="#0x4002-read_symlink"><code>0x4002</code> READ_SYMLINK</a></li>
<li><a href="#0xf000-format_async"><code>0xF000</code> FORMAT_ASYNC</a></li>
</ul>
</li>
<li><a href="#notifications">Notifications</a>
<ul>
<li><a href="#0x3002-file_read"><code>0x3002</code> FILE_READ</a></li>
<li><a href="#0x3004-file_written"><code>0x3004</code> FILE_WRITTEN</a></li>
<li><a href="#0xf000-formatted"><code>0xF000</code> FORMATTED</a></li>
</ul>
</li>
</ul>
<h2 id="nomenclature"><a class="header" href="#nomenclature">Nomenclature</a></h2>
<h3 id="storage-operating-range"><a class="header" href="#storage-operating-range">Storage operating range</a></h3>
<p>The <em>storage operating range</em> (SOR) is a 40-byte information transmitted to all operation methods of the filesystem interface to indicate where the requested operation should be performed and on which devices.</p>
<p>It is composed of:</p>
<ul>
<li>The device's <a href="../system/hw.html#unique-device-identifier">UDI</a> (8 bytes)</li>
<li>The partition's first byte address on the device (8 bytes)</li>
<li>The partition's last byte address on the device (8 bytes)</li>
<li><a href="../system/hw.html#0xd000-authorize_fs_interface">Authorization token</a> (8 bytes)</li>
<li>The filesystem's <a href="../../filesystem.html#filesystem-unique-identifier">FSID</a> (8 bytes)</li>
</ul>
<p>The FSID is only useful to identify partitions more easily, and to inform clients in <a href="#notifications">notifications</a>.</p>
<p>All SOR sent to the interface service are guaranteed to follow this specification, but may be invalid in case of a bad timing (e.g. authorization is <a href="../system/hw.html#0xd001-unauthorize_fs_interface">revoked</a> just before a request is performed).</p>
<h3 id="filesystem-paths"><a class="header" href="#filesystem-paths">Filesystem paths</a></h3>
<p>Filesystem paths are used to refer to specific filesystem elements and are encoded as either a <code>0x01</code> byte followed by a <a href="../../filesystem.html#element-unique-identifier">FEID</a>, or a <code>0x02</code> byte followed by a <a href="#split-paths">split path</a>.</p>
<p>All filesystem paths sent to the interface service are guaranteed to follow this specification.</p>
<h3 id="split-paths"><a class="header" href="#split-paths">Split paths</a></h3>
<p>All paths manipulated and returned by a filesystem interface services are encoded as <em>split paths</em>: <a href="../../kernel/data-structures.html#delimited-lists">delimited lists</a> of <a href="../../kernel/data-structures.html#delimited-strings">delimited strings</a>.</p>
<p>Each entry of the list must be a path's component. The entries, joined with a slash (<code>/</code>), should form a valid path.</p>
<p>Empty and <code>.</code> components are ignored, while components equal to <code>..</code> will make this component ignored and remove the previous component in the list.</p>
<p>The slash (<code>/</code>) character is forbidden in components.</p>
<p>An empty path refers to the root directory (when applicable).</p>
<h3 id="filenames"><a class="header" href="#filenames">Filenames</a></h3>
<p>Filenames are a <a href="../../kernel/data-structures.html#delimited-strings">delimited strings</a> with a few restrictions:</p>
<ul>
<li>Slash <code>/</code> characters are forbidden</li>
<li><code>NULL</code> characters (<code>U+0000</code>) are forbidden</li>
</ul>
<p>Moreover, filenames cannot be:</p>
<ul>
<li>Empty</li>
<li>Be made only of spaces or insecable spaces</li>
<li>Strictly equal to <code>.</code></li>
<li>Strictly equal to <code>..</code></li>
<li>Longer than 65535 characters</li>
</ul>
<p>Additional limitations may apply for some filesystems. Refer to each filesystem's specification to see the eventual limitations on filenames.</p>
<p>All filenames sent to the interface service are guaranteed to be follow this specification.</p>
<h3 id="capabilities-list"><a class="header" href="#capabilities-list">Capabilities list</a></h3>
<p>The <em>capabitilies list</em> is a 2-byte long value which indicate the capabitilies of a given filesystem:</p>
<ul>
<li>Bit  0: set if the filesystem is writable</li>
<li>Bit  1: set if the filesystem handles <a href="../../filesystem.html#symbolic-links">symbolic links</a></li>
<li>Bit  2: set if the filesystem allows symbolic links to non-existing items</li>
<li>Bit  3: set if the filesystem allows symbolic links to cross-filesystem items (need to store the target's <a href="../../filesystem.html#filesystem-unique-identifier">FSID</a>)</li>
<li>Bit  3: set if the filesystem supports hidden flag</li>
<li>Bit  4: set if the filesystem supports readonly flag</li>
<li>Bit  5: set if the filesystem can store creation dates</li>
<li>Bit  6: set if the filesystem can store modification dates</li>
<li>Bit  7: set if the filesystem can store last access dates</li>
<li>Bit  8: set if the filesystem can store an owner UID on 8 bytes</li>
<li>Bit  9: set if the filesystem can natively store a <a href="../../storage-permissions.html">storage permissions map</a></li>
<li>Bit 10: set if the interface can store a <a href="../../storage-permissions.html">storage permissions map</a> in the filesystem</li>
<li>Bit 11: set if the filesystem supports ahead space reservation</li>
</ul>
<p>In case the filesystem can't natively handle a <a href="../../storage-permissions.html">storage permissions map (SPM)</a>, the interface is allowed to store, query and update the map in the filesystem by itself, using non-native ways such as extended attributes. In such case, the relevant bit must be set to indicate a SPM can be stored on this filesystem.</p>
<p>This list acts as a contract between the service and the <a href="../system/fs.html"><code>sys::fs</code></a> service ; if a capability bit is not set, the related methods are guaranteed to never be called. If it is set, the "incompatibility" error code present in such methods cannot be returned or it will be considered a bug.</p>
<h3 id="filesystem-metadata"><a class="header" href="#filesystem-metadata">Filesystem metadata</a></h3>
<p>A <em>filesystem metadata</em> is a structure describing the a single filesystem:</p>
<ul>
<li><a href="#capabilities-list">Capabilities list</a> (2 bytes)</li>
<li>Cluster size in bytes (4 bytes)</li>
<li>Partition's total size in bytes (8 bytes)</li>
<li>Partition's used space in bytes (8 bytes)</li>
<li>Partition's free space in bytes (8 bytes) - used in case a part of the partition could not be used for any reason</li>
<li><a href="../../kernel/data-structures.html#options">Optional</a> partition's name as a <a href="../../kernel/data-structures.html#delimited-strings">delimited string</a></li>
<li><a href="../../kernel/data-structures.html#options">Optional</a> partition's <a href="../../kernel/data-structures.html#bitmap-images">icon</a></li>
</ul>
<h3 id="item-type-byte"><a class="header" href="#item-type-byte">Item type byte</a></h3>
<p>An <em>item type byte</em> is a single-byte value describing the type of a single item in a filesystem:</p>
<ul>
<li><code>0x01</code>: directory</li>
<li><code>0x02</code>: file</li>
<li><code>0x03</code>: symbolic link</li>
<li><code>0xFF</code>: unknown item type</li>
</ul>
<h3 id="item-flags"><a class="header" href="#item-flags">Item flags</a></h3>
<p>Each item has associated <em>flags</em>:</p>
<ul>
<li>Bit 0: hidden flag</li>
<li>Bit 1: read-only flag</li>
</ul>
<h3 id="item-metadata"><a class="header" href="#item-metadata">Item metadata</a></h3>
<p>An <em>item metadata</em> is a structure describing the content of a single item in a filesystem:</p>
<ul>
<li><a href="../../filesystem.html#element-unique-identifier">FEID</a> (8 bytes)</li>
<li><a href="#item-type-byte">Item type byte</a> (1 byte)</li>
<li><a href="#item-flags">Item flags</a> (1 byte)</li>
<li>Size in bytes (8 bytes) - <code>0</code> for directories</li>
<li><a href="../../kernel/data-structures.html#options">Optional</a> owner UID (8 bytes)</li>
<li><a href="../../kernel/data-structures.html#options">Optional</a> creation date <a href="../../kernel/data-structures.html#timestamps">timestamp</a> (1 + 8 bytes)</li>
<li><a href="../../kernel/data-structures.html#options">Optional</a> modification date <a href="../../kernel/data-structures.html#timestamps">timestamp</a> (1 + 8 bytes)</li>
<li><a href="../../kernel/data-structures.html#options">Optional</a> last access date <a href="../../kernel/data-structures.html#timestamps">timestamp</a> (1 + 8 bytes)</li>
<li>Item's <a href="#filenames">filename</a></li>
</ul>
<h2 id="methods"><a class="header" href="#methods">Methods</a></h2>
<h3 id="0x0001-handled_fs_list"><a class="header" href="#0x0001-handled_fs_list"><code>0x0001</code> HANDLED_FS_LIST</a></h3>
<p>Get informations about each filesystem handled by the current interface.</p>
<p><strong>Arguments:</strong></p>
<p><em>None</em></p>
<p><strong>Answer:</strong></p>
<ul>
<li><a href="../../kernel/data-structures.html#delimited-lists">Delimited list</a> of <a href="#filesystem-metadata">filesystem metadata</a></li>
</ul>
<p><strong>Errors:</strong></p>
<p><em>none</em></p>
<h3 id="0x0002-is_valid_partition"><a class="header" href="#0x0002-is_valid_partition"><code>0x0002</code> IS_VALID_PARTITION</a></h3>
<p>Check if a given partition is of the type of filesystem handled by the current interface.</p>
<p><strong>Arguments:</strong></p>
<ul>
<li>First bytes of the partition (512 bytes)</li>
<li>Last bytes of the partition (512 bytes)</li>
</ul>
<p><strong>Answer:</strong></p>
<ul>
<li>Identifier of the filesystem if it can be handled by the current interface, <code>0</code> otherwise (1 byte)</li>
</ul>
<p><strong>Errors:</strong></p>
<p><em>None</em></p>
<h3 id="0x0003-fs_metadata"><a class="header" href="#0x0003-fs_metadata"><code>0x0003</code> FS_METADATA</a></h3>
<p>Get metadata on a given filesystem.</p>
<p><strong>Arguments:</strong></p>
<ul>
<li><a href="#storage-operating-range">SOR</a> (40 bytes)</li>
</ul>
<p><strong>Return value:</strong></p>
<ul>
<li><a href="#filesystem-metadata">Filesystem metadata</a></li>
</ul>
<p><strong>Error codes:</strong></p>
<ul>
<li><code>0x3000</code>: Invalid SOR provided</li>
</ul>
<h3 id="0x1000-item_exists"><a class="header" href="#0x1000-item_exists"><code>0x1000</code> ITEM_EXISTS</a></h3>
<p>Check if a given item exists.</p>
<p><strong>Arguments:</strong></p>
<ul>
<li><a href="#storage-operating-range">SOR</a> (40 bytes)</li>
<li><a href="#filesystem-paths">Filesystem path</a></li>
<li><a href="#item-type-byte">Item type byte</a> (1 byte) to check if the item exists <strong>and</strong> is of a specific type - <code>0</code> to accept all types</li>
</ul>
<p><strong>Return value:</strong></p>
<ul>
<li><a href="#item-type-byte">Item type byte</a> (1 byte)</li>
</ul>
<p><strong>Errors:</strong></p>
<ul>
<li><code>0x3000</code>: Invalid SOR provided</li>
</ul>
<h3 id="0x1001-feid_to_split"><a class="header" href="#0x1001-feid_to_split"><code>0x1001</code> FEID_TO_SPLIT</a></h3>
<p>Convert a <a href="../../filesystem.html#element-unique-identifier">FEID</a> to the corresponding <a href="#split-paths">split path</a>.</p>
<p><strong>Arguments:</strong></p>
<ul>
<li><a href="#storage-operating-range">SOR</a> (40 bytes)</li>
<li><a href="../../filesystem.html#element-unique-identifier">FEID</a> (8 bytes)</li>
</ul>
<p><strong>Return value:</strong></p>
<ul>
<li><a href="#split-paths">Split path</a></li>
</ul>
<p><strong>Errors:</strong></p>
<ul>
<li><code>0x3000</code>: Invalid SOR provided</li>
<li><code>0x3001</code>: The provided FEID was not found in the filesystem</li>
</ul>
<h3 id="0x1002-item_metadata"><a class="header" href="#0x1002-item_metadata"><code>0x1002</code> ITEM_METADATA</a></h3>
<p>Get the metadata of a given item.</p>
<p><strong>Arguments:</strong></p>
<ul>
<li><a href="#storage-operating-range">SOR</a> (40 bytes)</li>
<li><a href="#filesystem-paths">Filesystem path</a></li>
</ul>
<p><strong>Return value:</strong></p>
<ul>
<li><a href="#item-metadata">Item metadata</a></li>
</ul>
<p><strong>Errors:</strong></p>
<ul>
<li><code>0x3000</code>: Invalid SOR provided</li>
<li><code>0x3001</code>: The provided path was not found</li>
</ul>
<h3 id="0x1003-rename_item"><a class="header" href="#0x1003-rename_item"><code>0x1003</code> RENAME_ITEM</a></h3>
<p>Rename an existing item.</p>
<p><strong>Arguments:</strong></p>
<ul>
<li><a href="#storage-operating-range">SOR</a> (40 bytes)</li>
<li><a href="#filesystem-paths">Filesystem path</a></li>
<li>New <a href="#filenames">filename</a></li>
</ul>
<p><strong>Errors:</strong></p>
<ul>
<li><code>0x3000</code>: Invalid filename provided</li>
<li><code>0x3001</code>: Invalid SOR provided</li>
<li><code>0x3002</code>: The provided path was not foud</li>
</ul>
<h3 id="0x1004-move_item"><a class="header" href="#0x1004-move_item"><code>0x1004</code> MOVE_ITEM</a></h3>
<p>Move an existing item.</p>
<p><strong>Arguments:</strong></p>
<ul>
<li><a href="#storage-operating-range">SOR</a> (40 bytes)</li>
<li><a href="#filesystem-paths">Filesystem path</a></li>
<li>New <a href="#filesystem-paths">parent directory</a></li>
<li><a href="../../kernel/data-structures.html#options">Optional</a> new <a href="#filenames">filename</a></li>
</ul>
<p><strong>Errors:</strong></p>
<ul>
<li><code>0x1000</code>: Invalid filename provided</li>
<li><code>0x3000</code>: Invalid SOR provided</li>
<li><code>0x3001</code>: The provided path was not found</li>
<li><code>0x3002</code>: Target directory was not found</li>
<li><code>0x4000</code>: Target directory's maximum capacity has been reached</li>
<li><code>0x4001</code>: Maximum nested items number has been reached</li>
<li><code>0x4002</code>: Maximum path length has been reached</li>
<li><code>0x4003</code>: Item cannot be moved for unspecified reasons</li>
<li><code>0x4FFF</code>: Unspecified filesystem error</li>
</ul>
<h3 id="0x1005-delete_item"><a class="header" href="#0x1005-delete_item"><code>0x1005</code> DELETE_ITEM</a></h3>
<p>Delete an item.</p>
<p><strong>Arguments:</strong></p>
<ul>
<li><a href="#storage-operating-range">SOR</a> (40 bytes)</li>
<li><a href="#filesystem-paths">Filesystem path</a></li>
</ul>
<p><strong>Return value:</strong></p>
<p><em>None</em></p>
<p><strong>Errors:</strong></p>
<ul>
<li><code>0x3000</code>: Invalid SOR provided</li>
<li><code>0x3001</code>: Item was not found</li>
<li><code>0x3002</code>: Cannot remove a non-empty directory</li>
<li><code>0x4FFF</code>: Unspecified filesystem error</li>
</ul>
<h3 id="0x2000-create_directory"><a class="header" href="#0x2000-create_directory"><code>0x2000</code> CREATE_DIRECTORY</a></h3>
<p>Create a directory.</p>
<p><strong>Arguments:</strong></p>
<ul>
<li><a href="#storage-operating-range">SOR</a> (40 bytes)</li>
<li><a href="#filesystem-paths">Filesystem path</a> of the parent directory</li>
<li>New item's <a href="#filenames">filename</a></li>
</ul>
<p><strong>Return value:</strong></p>
<p><em>None</em></p>
<p><strong>Errors:</strong></p>
<ul>
<li><code>0x1000</code>: Invalid filename provided</li>
<li><code>0x3000</code>: Invalid SOR provided</li>
<li><code>0x3001</code>: Parent directory was not found</li>
<li><code>0x4000</code>: Directory's maximum capacity has been reached</li>
<li><code>0x4001</code>: Maximum nested items number has been reached</li>
<li><code>0x4002</code>: Maximum path length has been reached</li>
<li><code>0x4FFF</code>: Unspecified filesystem error</li>
</ul>
<h3 id="0x2001-read_directory"><a class="header" href="#0x2001-read_directory"><code>0x2001</code> READ_DIRECTORY</a></h3>
<p>List all entries in a directory.</p>
<p>If the provided offset is larger than the number of entries in the directory, all remaining items must be returned.<br />
If the number of items to get is larger than the number of entries in the directory less the start offset, all remaining items must be returned.</p>
<p><strong>Arguments:</strong></p>
<ul>
<li><a href="#storage-operating-range">SOR</a> (40 bytes)</li>
<li><a href="#filesystem-paths">Filesystem path</a></li>
<li>Start offset (8 bytes)</li>
<li>Number of items to get (8 bytes) - <code>0</code> to list all items at once</li>
<li><a href="../../kernel/data-structures.html#options">Optional</a> total number of entries, if available (1 + 8 bytes)</li>
<li>Hidden flag match (1 byte): set to <code>0x00</code> to match only non-hidden items, <code>0x01</code> to match all items</li>
</ul>
<p><strong>Return value:</strong></p>
<ul>
<li><a href="../../kernel/data-structures.html#delimited-lists">Delimited list</a> of <a href="#item-metadata">item metadata</a></li>
</ul>
<p><strong>Errors:</strong></p>
<ul>
<li><code>0x3000</code>: Invalid SOR provided</li>
<li><code>0x3001</code>: Directory was not found</li>
<li><code>0x4FFF</code>: Unspecified filesystem error</li>
</ul>
<h3 id="0x3000-create_file"><a class="header" href="#0x3000-create_file"><code>0x3000</code> CREATE_FILE</a></h3>
<p>Create a file.</p>
<p>The reserved size is only provided if the interface reported the filesystem as <a href="#capabilities-list">supporting this feature</a>.</p>
<p><strong>Arguments:</strong></p>
<ul>
<li><a href="#storage-operating-range">SOR</a> (40 bytes)</li>
<li><a href="#filesystem-paths">Filesystem path</a> of the parent directory</li>
<li>New item's <a href="#filenames">filename</a></li>
<li><a href="../../kernel/data-structures.html#options">Optional</a> reserved size (1 + 8 bytes)</li>
<li><a href="../../kernel/data-structures.html#options">Optional</a> length of the buffer to write (1 + 8 bytes)</li>
<li>Buffer to write</li>
</ul>
<p><strong>Return value:</strong></p>
<p><em>None</em></p>
<p><strong>Errors:</strong></p>
<ul>
<li><code>0x1000</code>: Invalid filename provided</li>
<li><code>0x3000</code>: Invalid SOR provided</li>
<li><code>0x3001</code>: Parent directory was not found</li>
<li><code>0x4000</code>: Directory's maximum capacity has been reached</li>
<li><code>0x4001</code>: Maximum nested items number has been reached</li>
<li><code>0x4002</code>: Maximum path length has been reached</li>
<li><code>0x4003</code>: Storage's capacity exceeded</li>
<li><code>0x4004</code>: Maximum individual file size exceeded</li>
<li><code>0x4005</code>: Filesystem's free space exceeded</li>
<li><code>0x4FFF</code>: Unspecified filesystem error</li>
</ul>
<h3 id="0x3001-read_file_sync"><a class="header" href="#0x3001-read_file_sync"><code>0x3001</code> READ_FILE_SYNC</a></h3>
<p>Read a file synchronously.</p>
<p>If no read length is provided, the whole file must be read.</p>
<p><strong>Arguments:</strong></p>
<ul>
<li><a href="#storage-operating-range">SOR</a> (40 bytes)</li>
<li>File's <a href="#filesystem-paths">path</a></li>
<li>Start offset address (8 bytes)</li>
<li><a href="../../kernel/data-structures.html#options">Optional</a> length to read (1 + 8 bytes)</li>
</ul>
<p><strong>Return value:</strong></p>
<ul>
<li>Number of read bytes (8 bytes)</li>
<li>File's content</li>
</ul>
<p><strong>Errors:</strong></p>
<ul>
<li><code>0x3000</code>: Invalid SOR provided</li>
<li><code>0x3001</code>: Start offset is out-of-range</li>
<li><code>0x4FFF</code>: Unspecified filesystem error</li>
</ul>
<h3 id="0x3002-read_file_async"><a class="header" href="#0x3002-read_file_async"><code>0x3002</code> READ_FILE_ASYNC</a></h3>
<p>Asynchronously read a file to a writable <a href="../../kernel/memory.html#abstract-memory-segments">abstract memory segment (AMS)</a>.</p>
<p>THe number of bytes to read is always provided to ensure it does not accidentally exceed the AMS's size.</p>
<p>When the read is complete, a <a href="#0x3002-file_read"><code>FILE_READ</code></a> notification must be sent to the client.</p>
<p><strong>Arguments:</strong></p>
<ul>
<li><a href="#storage-operating-range">SOR</a> (40 bytes)</li>
<li>File's <a href="#filesystem-paths">path</a></li>
<li>Start offset address (8 bytes)</li>
<li>Number of bytes to read (8 bytes)</li>
<li>AMS identifier (8 bytes)</li>
</ul>
<p><strong>Return value:</strong></p>
<ul>
<li>Generated task identifier (8 bytes)</li>
</ul>
<p><strong>Errors:</strong></p>
<ul>
<li><code>0x3000</code>: Invalid SOR provided</li>
<li><code>0x3001</code>: Invalid AMS ID provided</li>
<li><code>0x4FFF</code>: Unspecified filesystem error</li>
</ul>
<h3 id="0x3003-write_file_sync"><a class="header" href="#0x3003-write_file_sync"><code>0x3003</code> WRITE_FILE_SYNC</a></h3>
<p>Synchronously write a buffer to a file.</p>
<p>If no offset address is provided, the file's content must be completely overriden with the provided buffer.</p>
<p><strong>Arguments:</strong></p>
<ul>
<li><a href="#storage-operating-range">SOR</a> (40 bytes)</li>
<li>File's <a href="#filesystem-paths">path</a></li>
<li><a href="../../kernel/data-structures.html#options">Optional</a> write offset address (1 + 8 bytes)</li>
<li>Number of bytes to write (8 bytes)</li>
<li>Buffer to write (8 bytes)</li>
</ul>
<p><strong>Return value:</strong></p>
<p><em>None</em></p>
<p><strong>Errors:</strong></p>
<ul>
<li><code>0x3000</code>: Invalid SOR provided</li>
<li><code>0x3001</code>: Offset is out-of-range</li>
<li><code>0x4000</code>: Storage's capacity exceeded</li>
<li><code>0x4001</code>: Maximum individual file size exceeded</li>
<li><code>0x4002</code>: Filesystem's free space exceeded</li>
<li><code>0x4FFF</code>: Unspecified filesystem error</li>
</ul>
<h3 id="0x3004-write_file_async"><a class="header" href="#0x3004-write_file_async"><code>0x3004</code> WRITE_FILE_ASYNC</a></h3>
<p>Asynchronously write a readable <a href="../../kernel/memory.html#abstract-memory-segments">abstract memory segment (AMS)</a> to a file.</p>
<p>If no offset address is provided, the file's content must be completely overriden with the provided buffer.</p>
<p>When the writing is complete, a <a href="#0x3004-file_written"><code>FILE_WRITTEN</code></a> notification must be sent to the client. The notification <strong>must not</strong> be sent before the current method returned successfully.</p>
<p><strong>Arguments:</strong></p>
<ul>
<li><a href="#storage-operating-range">SOR</a> (40 bytes)</li>
<li>File's <a href="#filesystem-paths">path</a></li>
<li><a href="../../kernel/data-structures.html#options">Optional</a> write offset address (1 + 8 bytes)</li>
<li>Number of bytes to write (8 bytes)</li>
<li>AMS identifier (8 bytes)</li>
</ul>
<p><strong>Return value:</strong></p>
<ul>
<li>Generated task identifier (8 bytes)</li>
</ul>
<p><strong>Errors:</strong></p>
<ul>
<li><code>0x3000</code>: Invalid SOR provided</li>
<li><code>0x3001</code>: Invalid AMS ID provided</li>
<li><code>0x4FFF</code>: Unspecified filesystem error</li>
</ul>
<h3 id="0x4000-create_symlink"><a class="header" href="#0x4000-create_symlink"><code>0x4000</code> CREATE_SYMLINK</a></h3>
<p>Create a <a href="../../filesystem.html#symbolic-links">symbolic link</a>.</p>
<p><strong>Arguments:</strong></p>
<ul>
<li><a href="#storage-operating-range">SOR</a> (40 bytes)</li>
<li><a href="#filesystem-paths">Filesystem path</a> of the parent directory</li>
<li>New item's <a href="#filenames">filename</a></li>
<li>Symlink's <a href="../../filesystem.html#filesystem-unique-identifier">target FSID</a> (8 bytes)</li>
<li>Symlink's <a href="#filesystem-paths">target path</a> (always a <a href="#split-paths">split path</a> for other filesystems)</li>
</ul>
<p><strong>Return value:</strong></p>
<p><em>None</em></p>
<p><strong>Errors:</strong></p>
<ul>
<li><code>0x1000</code>: Invalid filename provided</li>
<li><code>0x3000</code>: Invalid SOR provided</li>
<li><code>0x3001</code>: Parent directory was not found</li>
<li><code>0x3002</code>: Cannot create symbolic links to cross-filesystem items</li>
<li><code>0x3003</code>: Cannot create symbolic links to non-existing items</li>
<li><code>0x4000</code>: Directory's maximum capacity has been reached</li>
<li><code>0x4001</code>: Maximum nested items number has been reached</li>
<li><code>0x4002</code>: Maximum path length has been reached</li>
<li><code>0x4003</code>: Storage's capacity exceeded</li>
</ul>
<h3 id="0x4001-update_symlink"><a class="header" href="#0x4001-update_symlink"><code>0x4001</code> UPDATE_SYMLINK</a></h3>
<p>Create a <a href="../../filesystem.html#symbolic-links">symbolic link</a>.</p>
<p><strong>Arguments:</strong></p>
<ul>
<li><a href="#storage-operating-range">SOR</a> (40 bytes)</li>
<li>Symlink's <a href="#filesystem-paths">path</a></li>
<li>Symlink's <a href="../../filesystem.html#filesystem-unique-identifier">target FSID</a> (8 bytes)</li>
<li>Symlink's <a href="#filesystem-paths">target path</a></li>
</ul>
<p><strong>Return value:</strong></p>
<p><em>None</em></p>
<p><strong>Errors:</strong></p>
<ul>
<li><code>0x3000</code>: Invalid SOR provided</li>
<li><code>0x3001</code>: Provided path was not found</li>
<li><code>0x3002</code>: Cannot crate symbolic links to cross-filesystem items</li>
<li><code>0x3003</code>: Cannot crate symbolic links to non-existing items</li>
</ul>
<h3 id="0x4002-read_symlink"><a class="header" href="#0x4002-read_symlink"><code>0x4002</code> READ_SYMLINK</a></h3>
<p>Read a <a href="../../filesystem.html#symbolic-links">symbolic link</a>'s target.</p>
<p><strong>Arguments:</strong></p>
<ul>
<li><a href="#storage-operating-range">SOR</a> (40 bytes)</li>
<li>Symlink's <a href="#filesystem-paths">path</a></li>
</ul>
<p><strong>Return value:</strong></p>
<ul>
<li>Symlink's <a href="../../filesystem.html#filesystem-unique-identifier">target FSID</a> (8 bytes)</li>
<li>Symlink's <a href="#filesystem-paths">target path</a></li>
</ul>
<p><strong>Errors:</strong></p>
<ul>
<li><code>0x3000</code>: Invalid SOR provided</li>
<li><code>0x3001</code>: Provided path was not found</li>
<li><code>0x4000</code>: Symbolic link is cyclic</li>
</ul>
<h3 id="0xf000-format_async"><a class="header" href="#0xf000-format_async"><code>0xF000</code> FORMAT_ASYNC</a></h3>
<p>Asynchronously format the partition to get an empty filesystem. Once the formatting is complete,</p>
<p><strong>Arguments:</strong></p>
<ul>
<li><a href="#storage-operating-range">SOR</a> (40 bytes)</li>
<li><a href="../../kernel/data-structures.html#options">Optional</a> new partition's sector size, in bytes (8 bytes)</li>
</ul>
<p><strong>Return value:</strong></p>
<ul>
<li>Generated task identifier (8 bytes)</li>
</ul>
<p><strong>Error codes:</strong></p>
<ul>
<li><code>0x1000</code>: Invalid sector size provided</li>
<li><code>0x3000</code>: Invalid SOR provided</li>
</ul>
<h2 id="notifications"><a class="header" href="#notifications">Notifications</a></h2>
<h3 id="0x3002-file_read"><a class="header" href="#0x3002-file_read"><code>0x3002</code> FILE_READ</a></h3>
<p>Sent to a client after an asynchronous file reading requested using the <a href="#0x3002-read_file_async"><code>READ_FILE_ASYNC</code></a> method completed.</p>
<p><strong>Datafield:</strong></p>
<ul>
<li>Task identifier (8 bytes)</li>
<li><a href="../../kernel/data-structures.html#fallible-results">Fallible result</a> with:
<ul>
<li>Success data: number of bytes read (8 bytes)</li>
<li>Error code (1 byte)
<ul>
<li><code>0x20</code>: Start offset is out-of-range</li>
<li><code>0x40</code>: Unspecified filesystem error</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="0x3004-file_written"><a class="header" href="#0x3004-file_written"><code>0x3004</code> FILE_WRITTEN</a></h3>
<p>Sent to a client after an asynchronous file writing requested using the <a href="#0x3004-write_file_async"><code>WRITE_FILE_ASYNC</code></a> method completed.</p>
<p><strong>Datafield:</strong></p>
<ul>
<li>Task identifier (8 bytes)</li>
<li><a href="../../kernel/data-structures.html#fallible-results">Fallible result</a> with:
<ul>
<li>Success data: <em>None</em></li>
<li>Error code (1 byte):
<ul>
<li><code>0x20</code>: Start offset is out-of-range</li>
<li><code>0x31</code>: Maximum individual file size exceeded</li>
<li><code>0x32</code>: Filesystem's free space exceeded</li>
<li><code>0x40</code>: Unspecified filesystem error</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="0xf000-formatted"><a class="header" href="#0xf000-formatted"><code>0xF000</code> FORMATTED</a></h3>
<p>Sent to a client after an formatting requested using the <a href="#0xf000-format_async"><code>FORMAT_ASYC</code></a> method completed.</p>
<p><strong>Datafield:</strong></p>
<ul>
<li>Task identifier (8 bytes)</li>
<li><a href="../../kernel/data-structures.html#fallible-results">Fallible result</a> with:
<ul>
<li>Success data: <em>None</em></li>
<li>Error code (1 byte):
<ul>
<li><code>0x40</code>: Unspecified filesystem error</li>
</ul>
</li>
</ul>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../specs/services/integration/file-openers.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../specs/services/drivers/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../specs/services/integration/file-openers.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../specs/services/drivers/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>

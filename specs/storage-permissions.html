<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Storage permissions - NightOS documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Design and specification documents for NightOS">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">NightOS documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/ClementNerma/NightOS" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="storage-permissions"><a class="header" href="#storage-permissions">Storage permissions</a></h1>
<p>This document presents how permissions are handled on filesystems.</p>
<h2 id="how-permissions-work"><a class="header" href="#how-permissions-work">How permissions work</a></h2>
<p>Each item (identified by its <a href="filesystem.html#element-unique-identifier">FEID</a>) uses a set of permissions determined by multiple rules.</p>
<ul>
<li>Items in the <code>/dev</code>, <code>/etc</code> and <code>/sys</code> are not available to any user.</li>
<li>Items in a <code>/app/&lt;xxx&gt;</code> directory are only available to the <code>xxx</code> application. Users do not have direct access to these files.</li>
<li>Items in a <code>/home/&lt;xxx&gt;</code> directory are only available to the <code>xxx</code> user.</li>
<li>Items in a <code>/mnt/&lt;xxx&gt;</code> directory can be available to various users depending on the mount options.</li>
</ul>
<p>Note that an exception is made for the <a href="../concepts/users.html#user-permissions-level">system user</a> which gets access to every single file.</p>
<p>These are the default permissions, but it's possible to restrict or extend permissions based on a <strong>Storage Permissions Map</strong> (or <strong>SPM</strong>).</p>
<h2 id="structure"><a class="header" href="#structure">Structure</a></h2>
<p>The SPM is a non-contiguous data structure which can be located anywhere in the filesystem.</p>
<h3 id="header"><a class="header" href="#header">Header</a></h3>
<p>The SPM's header is a contiguous block located at its beginning.</p>
<p>It is made of the following:</p>
<ul>
<li>Number of pages (8 bytes)</li>
<li>Address of the first page (8 bytes) - <code>0</code> if none</li>
<li>Address of the last page (8 bytes) - <code>0</code> if none</li>
</ul>
<h3 id="pages-header"><a class="header" href="#pages-header">Pages' header</a></h3>
<p>Each page is made of a contiguous header (data block) made of the following:</p>
<ul>
<li>Maximum number of entries (capacity) (8 bytes)</li>
<li>Number of free entries (8 bytes)</li>
<li>Address of the previous page (8 bytes) - <code>0</code> if none</li>
<li>Address of the next page (8 bytes) - <code>0</code> if none</li>
<li>For each entry:
<ul>
<li>Address of the entry (8 bytes)</li>
</ul>
</li>
</ul>
<h3 id="entries"><a class="header" href="#entries">Entries</a></h3>
<p>Each page contains a set of entries, which may be split on the disk. An entry is made of the following:</p>
<ul>
<li>Address of the page referencing this entry (8 bytes)</li>
<li><a href="filesystem.html#element-unique-identifier">FEID</a> of the item this entry is for (8 bytes)</li>
<li>Number of entities described in the entry (8 bytes)</li>
<li>For each entity:
<ul>
<li>Entity type (1 byte):
<ul>
<li><code>0x01</code>: <a href="../concepts/users.html">User</a></li>
<li><code>0x02</code>: <a href="../concepts/users.html#groups">Group</a></li>
</ul>
</li>
<li>Entity ID (8 bytes)</li>
<li><a href="#permission-levels">Permission levels</a>
<ul>
<li>Bits 00-01: List directory's content</li>
<li>Bits 02-03: Read files</li>
<li>Bits 04-05: Create new items</li>
<li>Bits 06-07: Edit items</li>
<li>Bits 08-09: Delete items</li>
<li>Bits 10-11: Read metadata</li>
<li>Bits 12-13: Write metadata</li>
<li>Bits 14-15: Change owner</li>
<li>Bits 16-17: Edit SPM permissions</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>An item's owner will have all of these permissions set by default.</p>
<p>An entry's content must be contiguous ; if it grows too large to fit inside its allocated space when updated, it must be moved somewhere else.</p>
<h3 id="permission-levels"><a class="header" href="#permission-levels">Permission levels</a></h3>
<p>A <em>permission level</em> is a 2-bit value which can either be:</p>
<ul>
<li><code>0b00</code>: inherit from the parent entity / from the system's settings</li>
<li><code>0b01</code>: refuse for this specific item</li>
<li><code>0b10</code>: allow for this item, recursively</li>
<li><code>0b11</code>: allow for this item but only for content owned by the referred entity, recursively</li>
</ul>
<h3 id="file-table-pointer"><a class="header" href="#file-table-pointer">File table pointer</a></h3>
<p>Unless a filesystem does not support it, nor natively or through the use of extended attributes, each file and directory's entry must contain the address of its entry in the SPM, with <code>0</code> indicating no entry exists for it.</p>
<p>When the item is created, no entry is created for it by default. It's only when permissions are set for the item that an entry is made and referenced in the file table.</p>
<p>When the entry is cleared, it is destroyed and the <code>0</code> value is assigned back to the file table entry's SPM pointer.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../specs/filesystem.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../specs/boot-process.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../specs/filesystem.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../specs/boot-process.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
